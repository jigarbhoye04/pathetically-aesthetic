<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>Pixel Pattern Generator</title>
      <style>
         /* Minimalistic styles for initial name input */
         .name-input-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            padding: 2rem;
            background-color: rgba(20, 20, 30, 0.8); /* Dark background */
            border-radius: 8px; /* Less rounded */
            color: white;
         }

         .name-input-container h2 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
         }

         .name-input-container input {
            padding: 0.75rem 1rem;
            border-radius: 4px; /* Less rounded input */
            border: 1px solid rgba(255, 255, 255, 0.2);
            background-color: rgba(255, 255, 255, 0.05);
            color: white;
         }

         .name-input-container button {
            padding: 0.6rem 1.2rem;
            border-radius: 4px; /* Less rounded button */
            border: none;
            background-color: #6a6ab8; /* Simple color */
            color: white;
            cursor: pointer;
            transition: background-color 0.3s ease;
         }

         .name-input-container button:hover {
            background-color: #8a8ac8;
         }


          /* Specific styles for the input-container and its children */
          .glass-panel.input-container {
            background: rgba(20, 20, 30, 0.95); /* Matte dark gray with slight transparency */
            backdrop-filter: blur(12px); /* Subtle blur for a classy matte effect */
            border-radius: 8px; /* More Squarish - reduced from 24px */
            border: 2px solid rgba(255, 255, 255, 0.1); /* Subtle white border for elegance */
            padding: 3rem 2.5rem; /* Increased padding for sophistication */
            width: 100%;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3), 0 0 15px rgba(100, 100, 150, 0.2); /* Soft shadow for depth */
            transition: all 400ms ease; /* Smooth transitions for interactivity */
            position: relative;
            overflow: hidden;
            display: none; /* Hidden initially, shown after name input - will be removed later */
          }

          .glass-panel.input-container.visible {
              display: flex; /* To make it visible if needed later */
          }

          .glass-panel.input-container::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(50, 50, 70, 0.1), rgba(30, 30, 50, 0.1)); /* Subtle matte gradient */
            z-index: -1;
            border-radius: 8px; /* More Squarish - reduced from 24px */
          }

          h1 {
            font-size: 3rem;
            font-weight: 800;
            text-align: center;
            text-transform: uppercase; /* Modern, classy touch */
            background: linear-gradient(90deg, #e0e0ff, #a0a0d0, #e0e0ff); /* Sophisticated gradient */
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 8px rgba(160, 160, 200, 0.3); /* Subtle glow */
            letter-spacing: 1px;
            font-family: 'Poppins', sans-serif; /* Elegant, modern font */
            margin-bottom: 1.5rem;
          }

          .description {
            font-size: 1.1rem;
            line-height: 1.8;
            color: rgba(255, 255, 255, 0.8); /* Soft white for readability */
            text-align: center;
            max-width: 600px;
            font-family: 'Roboto', sans-serif; /* Clean, classy font */
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); /* Subtle shadow for depth */
            margin-bottom: 1.5rem;
          }

          .input-field {
            width: 100%;
            max-width: 550px; /* Slightly wider for a premium look */
          }

          input {
            width: 100%;
            background: rgba(255, 255, 255, 0.03); /* Very subtle matte white */
            border: 2px solid rgba(255, 255, 255, 0.15); /* Soft white border */
            padding: 1.2rem 1.8rem;
            border-radius: 8px; /* More Squarish - reduced from 30px */
            font-size: 1.2rem;
            color: #fff;
            transition: all 400ms ease;
            box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.1); /* Subtle inset for matte effect */
            font-family: 'Poppins', sans-serif;
          }

          input:focus {
            border-color: rgba(160, 160, 200, 0.4); /* Classy light purple */
            box-shadow: 0 0 15px rgba(160, 160, 200, 0.3), inset 0 0 10px rgba(160, 160, 200, 0.2); /* Soft glow */
            transform: scale(1.02); /* Slight zoom for interactivity */
          }

          .generate-btn {
            background: linear-gradient(135deg, #4a4a7a, #8a8ac8); /* Matte purple gradient */
            border: none;
            padding: 1rem 2.5rem;
            border-radius: 8px; /* More Squarish - reduced from 30px */
            font-size: 1.2rem;
            font-weight: 700;
            color: #fff;
            cursor: pointer;
            transition: all 400ms ease;
            box-shadow: 0 5px 20px rgba(74, 74, 122, 0.3), 0 0 10px rgba(138, 138, 200, 0.2); /* Soft shadow */
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            font-family: 'Poppins', sans-serif;
            position: relative;
            overflow: hidden;
          }

          .generate-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.01)); /* Subtle matte shimmer */
            z-index: 0;
            animation: shimmer 2s linear infinite;
          }

          @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
          }

          .generate-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 30px rgba(74, 74, 122, 0.5), 0 0 15px rgba(138, 138, 200, 0.3);
          }

          .controls {
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 1rem;
          }

          .control-btn {
            background: linear-gradient(135deg, #3a3a6a, #6a6ab8); /* Matte blue-purple gradient */
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px; /* More Squarish - reduced from 25px */
            font-size: 1rem;
            color: #fff;
            cursor: pointer;
            transition: all 400ms ease;
            box-shadow: 0 4px 15px rgba(58, 58, 106, 0.3), 0 0 8px rgba(106, 106, 184, 0.2);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            font-family: 'Poppins', sans-serif;
          }

          .control-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(58, 58, 106, 0.5), 0 0 12px rgba(106, 106, 184, 0.3);
          }
         :root {
            --bg-color: #0a0c1a; /* Deeper background */
            --glass-bg: rgba(20, 25, 40, 0.85);
            --border-color: rgba(255, 255, 255, 0.15);
            --text-color: rgba(255, 255, 255, 0.95);
         }

         * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
               Roboto, sans-serif;
         }

         body {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            /* background: var(--bg-color); */
            overflow-x: hidden;
            color: var(--text-color);
            background: linear-gradient(
               135deg,
               var(--bg-color),
               #1a1e33
            ); /* Gradient background */
         }

         h1 {
            font-size: 3rem;
            text-shadow: 0 4px 12px rgba(160, 160, 255, 0.4),
               0 0 20px rgba(255, 255, 255, 0.2);
            background: linear-gradient(90deg, #ffffff, #a0a0ff, #ff80bf);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-fill-color: transparent;
         }

         .pixel:hover {
            transform: scale(1.1);
            box-shadow: 0 0 10px currentColor, 0 0 20px rgba(255, 255, 255, 0.3); /* Glow effect */
            transition: all 300ms ease;
         }

         .control-btn {
            background: linear-gradient(135deg, #3b2d9f, #8a6dff);
            border: none;
            box-shadow: 0 4px 15px rgba(91, 66, 243, 0.4);
         }

         .control-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(91, 66, 243, 0.6);
         }
         .container {
            position: relative;
            width: 100%;
            max-width: 80rem;
            padding: 3rem 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
         }

         .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 8px; /* More Squarish - reduced from 16px */
            border: 1px solid var(--border-color);
            padding: 2rem;
            width: 100%;
            /* box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2); */
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.3),
               0 0 20px rgba(91, 66, 243, 0.2); /* Neon glow */
            transition: all 300ms cubic-bezier(0.4, 0, 0.2, 1);
         }

         .input-container {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            align-items: center;
         }

         .description {
            font-size: 1.1rem;
            line-height: 1.6;
            text-align: center;
            max-width: 600px;
            margin-bottom: 1rem;
         }

         .input-field {
            position: relative;
            width: 100%;
            max-width: 500px;
         }

         input {
            width: 100%;
            background: rgba(255, 255, 255, 0.07);
            border: 1px solid rgba(255, 255, 255, 0.15);
            padding: 1rem 1.5rem;
            border-radius: 8px; /* More Squarish - reduced from 50px */
            font-size: 1.1rem;
            color: white;
            transition: all 300ms ease;
            outline: none;
         }

         input:focus {
            border-color: rgba(255, 255, 255, 0.3);
            box-shadow: 0 0 15px rgba(100, 100, 255, 0.3);
         }

         .generate-btn {
            background: linear-gradient(135deg, #5b42f3 0%, #c0b1fc 100%);
            border: none;
            padding: 0.8rem 2rem;
            border-radius: 8px; /* More Squarish - reduced from 50px */
            font-size: 1rem;
            font-weight: 600;
            color: white;
            cursor: pointer;
            transition: all 300ms ease;
            box-shadow: 0 4px 15px rgba(91, 66, 243, 0.4);
         }

         .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(91, 66, 243, 0.6);
         }

         .generate-btn:active {
            transform: translateY(1px);
         }

         .pixel-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(24px, 1fr));
            gap: 4px;
            width: 100%;
            margin-top: 1rem;
            transition: all 300ms ease;
            opacity: 0;
            transform: translateY(20px);
         }

         .pixel-container.visible {
            opacity: 1;
            transform: translateY(0);
         }

         .pixel {
            aspect-ratio: 1;
            border-radius: 6px; /* More Rounded Pixels - adjusted from 4px, but not circles */
            background-color: transparent;
            transition: background-color 500ms ease, transform 300ms cubic-bezier(0.4, 0, 0.2, 1); /* Smooth background transition */
            will-change: transform, background-color;
            cursor: pointer;
         }

         .pixel:hover {
            transform: scale(1.1);
            z-index: 2;
         }
         .pixel {
            position: relative;
         }

         .pixel::before {
            content: "";
            position: absolute;
            top: -70px; /* Position above pixel */
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 40px; /* Larger main color */
            background-color: currentColor; /* Main pixel color */
            border-radius: 8px;
            opacity: 0;
            transition: opacity 300ms ease, transform 300ms ease;
            z-index: 4;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
         }

         .pixel::after {
            content: "";
            position: absolute;
            top: -25px; /* Adjusted to sit above pixel but below main color */
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 20px; /* Similar colors bar */
            background: linear-gradient(90deg, var(--color1), var(--color2));
            border-radius: 4px;
            opacity: 0;
            transition: opacity 300ms ease, transform 300ms ease;
            pointer-events: none;
            z-index: 3;
         }

         .pixel:hover::before,
         .pixel:hover::after {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px); /* Smooth slide up */
         }

         /* Matte-glossy-black container */
         .pixel:hover::before {
            background: rgba(10, 10, 20, 0.9); /* Matte-glossy-black */
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.1);
         }

         /* Ensure tooltip stays within screen */
         .pixel {
            overflow: visible; /* Allow tooltip to show */
         }
         .wave-animation {
            position: relative;
            width: 100%;
            height: 60px;
            margin-top: 2rem;
            overflow: hidden;
            opacity: 0;
            transition: opacity 300ms ease;
         }

         .wave-animation.visible {
            opacity: 1;
         }

         .wave {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
               90deg,
               rgba(255, 50, 50, 0.2) 0%,
               rgba(255, 150, 50, 0.2) 14%,
               rgba(255, 255, 50, 0.2) 28%,
               rgba(50, 255, 50, 0.2) 42%,
               rgba(50, 150, 255, 0.2) 56%,
               rgba(150, 50, 255, 0.2) 70%,
               rgba(255, 50, 150, 0.2) 85%,
               rgba(255, 50, 50, 0.2) 100%
            );
            animation: wave-animation 8s linear infinite;
            border-radius: 8px;
         }

         @keyframes wave-animation {
            0% {
               transform: translateX(0) scaleY(0.2);
            }
            50% {
               transform: translateX(-25%) scaleY(0.8);
            }
            100% {
               transform: translateX(0) scaleY(0.2);
            }
         }

         .wave:nth-child(2) {
            animation-delay: -2s;
            opacity: 0.7;
         }

         .wave:nth-child(3) {
            animation-delay: -4s;
            opacity: 0.5;
         }

         .wave:nth-child(4) {
            animation-delay: -6s;
            opacity: 0.3;
         }

         .controls {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
            flex-wrap: wrap;
            justify-content: center;
            display: none; /* Hide controls initially */
         }

         .controls.visible {
            display: flex; /* Show controls when needed */
         }


         .control-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.15);
            padding: 0.5rem 1rem;
            border-radius: 8px; /* More Squarish - reduced from 50px */
            font-size: 0.9rem;
            color: white;
            cursor: pointer;
            transition: all 300ms ease;
         }

         .control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
         }

         @media (max-width: 768px) {
            .container {
               padding: 2rem 1rem;
            }

            h1 {
               font-size: 2rem;
            }

            .description {
               font-size: 1rem;
            }

            .pixel-container {
               grid-template-columns: repeat(auto-fill, minmax(18px, 1fr));
               gap: 3px;
            }
         }

         @media (max-width: 480px) {
            .pixel-container {
               grid-template-columns: repeat(auto-fill, minmax(12px, 1fr));
               gap: 2px;
            }

            h1 {
               font-size: 1.5rem;
            }
         }

         @keyframes pulse-animation { /* Renamed to avoid conflict and for clarity */
          0% { transform: scale(1); }
          100% { transform: scale(1.15); } /* Slightly stronger pulse */
        }
         @keyframes heartbeat-pulse {
          0% { transform: scale(1); opacity: 0.8; }
          50% { transform: scale(1.2); opacity: 1; }
          100% { transform: scale(1); opacity: 0.8; }
        }
      </style>
   </head>
   <body>
      <div class="container">
        <div class="name-input-container" id="name-input-container">
            <h2>Enter Your Name</h2>
            <input type="text" id="user-name-input" placeholder="Your Name" autofocus>
            <button id="submit-name-btn">Show Pattern</button>
        </div>

        <div class="glass-panel input-container" id="input-container">
          <h1>Pixel Pattern Generator</h1>
          <p class="description">
            Pattern Generated for <span id="user-display-name"></span>!
          </p>
          <div class="input-field" style="display:none;"> <!-- Hidden Input Field -->
            <input type="text" id="text-input" placeholder="Enter your text..." >
          </div>
          <button class="generate-btn" id="generate-btn" style="display:none;">Generate Pattern</button> <!-- Hidden Generate Button -->
          <div class="controls" id="controls">
            <button class="control-btn" id="randomize-btn">Randomize Colors</button>
            <button class="control-btn" id="toggle-animation-btn" style="display:none;">Toggle Animation</button> <!-- Hidden Toggle Animation Button -->
          </div>
        </div>


         <div class="glass-panel">
            <div class="pixel-container visible" id="pixel-container"></div>
            <div class="wave-animation visible" id="wave-animation">
               <div class="wave"></div>
               <div class="wave"></div>
               <div class="wave"></div>
               <div class="wave"></div>
            </div>
         </div>
      </div>

      <script>
         function hexToHsl(hex) {
            let r = parseInt(hex.slice(1, 3), 16) / 255;
            let g = parseInt(hex.slice(3, 5), 16) / 255;
            let b = parseInt(hex.slice(5, 7), 16) / 255;
            let max = Math.max(r, g, b),
               min = Math.min(r, g, b);
            let h,
               s,
               l = (max + min) / 2;
            if (max === min) {
               h = s = 0;
            } else {
               let d = max - min;
               s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
               switch (max) {
                  case r:
                     h = (g - b) / d + (g < b ? 6 : 0);
                     break;
                  case g:
                     h = (b - r) / d + 2;
                     break;
                  case b:
                     h = (r - g) / d + 4;
                     break;
               }
               h /= 6;
            }
            return { h: h * 360, s: s * 100, l: l * 100 };
         }

         function getSimilarColor(color) {
            const hsl = hexToHsl(color);
            const hueVariation = 10;
            const newHue =
               (hsl.h + Math.random() * hueVariation - hueVariation / 2) % 360;
            return `hsl(${newHue}, ${hsl.s}%, ${hsl.l}%)`;
         }

         document.addEventListener("DOMContentLoaded", function () {
            const userNameInputContainer = document.getElementById("name-input-container");
            const userNameInput = document.getElementById("user-name-input");
            const submitNameBtn = document.getElementById("submit-name-btn");
            const inputContainer = document.getElementById("input-container");
            const userDisplayName = document.getElementById("user-display-name");


            const textInput = document.getElementById("text-input");
            const generateBtn = document.getElementById("generate-btn");
            const pixelContainer = document.getElementById("pixel-container");
            const waveAnimation = document.getElementById("wave-animation");
            const randomizeBtn = document.getElementById("randomize-btn");
            const controls = document.getElementById("controls");
            const toggleAnimationBtn = document.getElementById(
               "toggle-animation-btn"
            );

            let animationEnabled = true;
            let pixels = [];
            let textMap = [];
            let currentText = ""; // Store current text for randomization

            const colors = [
               "#FF3D00",
               "#FF9100",
               "#FFEA00",
               "#64DD17",
               "#00B0FF",
               "#7C4DFF",
               "#F50057",
            ];

            // Simple 5x3 pixel font (1 = pixel on, 0 = pixel off)
            const font = {
               A: [
                  [0, 1, 0],
                  [1, 0, 1],
                  [1, 1, 1],
                  [1, 0, 1],
                  [1, 0, 1],
               ],
               B: [
                  [1, 1, 0],
                  [1, 0, 1],
                  [1, 1, 0],
                  [1, 0, 1],
                  [1, 1, 0],
               ],
               C: [
                  [0, 1, 1],
                  [1, 0, 0],
                  [1, 0, 0],
                  [1, 0, 0],
                  [0, 1, 1],
               ],
               D: [
                  [1, 1, 0],
                  [1, 0, 1],
                  [1, 0, 1],
                  [1, 0, 1],
                  [1, 1, 0],
               ],
               E: [
                  [1, 1, 1],
                  [1, 0, 0],
                  [1, 1, 0],
                  [1, 0, 0],
                  [1, 1, 1],
               ],
               F: [
                  [1, 1, 1],
                  [1, 0, 0],
                  [1, 1, 0],
                  [1, 0, 0],
                  [1, 0, 0],
               ],
               G: [
                  [0, 1, 1],
                  [1, 0, 0],
                  [1, 0, 1],
                  [1, 0, 1],
                  [0, 1, 1],
               ],
               H: [
                  [1, 0, 1],
                  [1, 0, 1],
                  [1, 1, 1],
                  [1, 0, 1],
                  [1, 0, 1],
               ],
               I: [
                  [1, 1, 1],
                  [0, 1, 0],
                  [0, 1, 0],
                  [0, 1, 0],
                  [1, 1, 1],
               ],
               J: [
                  [0, 0, 1],
                  [0, 0, 1],
                  [0, 0, 1],
                  [1, 0, 1],
                  [0, 1, 0],
               ],
               K: [
                  [1, 0, 1],
                  [1, 1, 0],
                  [1, 0, 0],
                  [1, 1, 0],
                  [1, 0, 1],
               ],
               L: [
                  [1, 0, 0],
                  [1, 0, 0],
                  [1, 0, 0],
                  [1, 0, 0],
                  [1, 1, 1],
               ],
               M: [
                  [1, 0, 1],
                  [1, 1, 1],
                  [1, 0, 1],
                  [1, 0, 1],
                  [1, 0, 1],
               ],
               N: [
                  [1, 0, 1],
                  [1, 1, 1],
                  [1, 1, 1],
                  [1, 0, 1],
                  [1, 0, 1],
               ],
               O: [
                  [0, 1, 0],
                  [1, 0, 1],
                  [1, 0, 1],
                  [1, 0, 1],
                  [0, 1, 0],
               ],
               P: [
                  [1, 1, 0],
                  [1, 0, 1],
                  [1, 1, 0],
                  [1, 0, 0],
                  [1, 0, 0],
               ],
               Q: [
                  [0, 1, 0],
                  [1, 0, 1],
                  [1, 0, 1],
                  [1, 1, 1],
                  [0, 1, 1],
               ],
               R: [
                  [1, 1, 0],
                  [1, 0, 1],
                  [1, 1, 0],
                  [1, 1, 0],
                  [1, 0, 1],
               ],
               S: [
                  [0, 1, 1],
                  [1, 0, 0],
                  [0, 1, 0],
                  [0, 0, 1],
                  [1, 1, 0],
               ],
               T: [
                  [1, 1, 1],
                  [0, 1, 0],
                  [0, 1, 0],
                  [0, 1, 0],
                  [0, 1, 0],
               ],
               U: [
                  [1, 0, 1],
                  [1, 0, 1],
                  [1, 0, 1],
                  [1, 0, 1],
                  [0, 1, 0],
               ],
               V: [
                  [1, 0, 1],
                  [1, 0, 1],
                  [1, 0, 1],
                  [0, 1, 0],
                  [0, 1, 0],
               ],
               W: [
                  [1, 0, 1],
                  [1, 0, 1],
                  [1, 0, 1],
                  [1, 1, 1],
                  [1, 0, 1],
               ],
               X: [
                  [1, 0, 1],
                  [1, 0, 1],
                  [0, 1, 0],
                  [1, 0, 1],
                  [1, 0, 1],
               ],
               Y: [
                  [1, 0, 1],
                  [1, 0, 1],
                  [0, 1, 0],
                  [0, 1, 0],
                  [0, 1, 0],
               ],
               Z: [
                  [1, 1, 1],
                  [0, 0, 1],
                  [0, 1, 0],
                  [1, 0, 0],
                  [1, 1, 1],
               ],
               " ": [
                  [0, 0, 0],
                  [0, 0, 0],
                  [0, 0, 0],
                  [0, 0, 0],
                  [0, 0, 0],
               ],
               ",": [
                  [0, 0, 0],
                  [0, 0, 0],
                  [0, 0, 0],
                  [0, 1, 0],
                  [1, 0, 0],
               ],
               "'": [
                  [0, 1, 0],
                  [0, 1, 0],
                  [0, 0, 0],
                  [0, 0, 0],
                  [0, 0, 0],
               ],
               ".": [
                  [0, 0, 0],
                  [0, 0, 0],
                  [0, 0, 0],
                  [0, 0, 0],
                  [0, 1, 0],
               ],
               "!": [
                  [0, 1, 0],
                  [0, 1, 0],
                  [0, 1, 0],
                  [0, 0, 0],
                  [0, 1, 0],
               ],
               "?": [
                  [1, 1, 1],
                  [0, 0, 1],
                  [0, 1, 1],
                  [0, 0, 0],
                  [0, 1, 0],
               ],
               0: [
                  [0, 1, 0],
                  [1, 0, 1],
                  [1, 0, 1],
                  [1, 0, 1],
                  [0, 1, 0],
               ],
               1: [
                  [0, 1, 0],
                  [1, 1, 0],
                  [0, 1, 0],
                  [0, 1, 0],
                  [1, 1, 1],
               ],
               2: [
                  [1, 1, 0],
                  [0, 0, 1],
                  [0, 1, 0],
                  [1, 0, 0],
                  [1, 1, 1],
               ],
               3: [
                  [1, 1, 1],
                  [0, 0, 1],
                  [0, 1, 1],
                  [0, 0, 1],
                  [1, 1, 1],
               ],
               4: [
                  [1, 0, 1],
                  [1, 0, 1],
                  [1, 1, 1],
                  [0, 0, 1],
                  [0, 0, 1],
               ],
               5: [
                  [1, 1, 1],
                  [1, 0, 0],
                  [1, 1, 1],
                  [0, 0, 1],
                  [1, 1, 0],
               ],
               6: [
                  [0, 1, 1],
                  [1, 0, 0],
                  [1, 1, 1],
                  [1, 0, 1],
                  [0, 1, 0],
               ],
               7: [
                  [1, 1, 1],
                  [0, 0, 1],
                  [0, 1, 0],
                  [0, 1, 0],
                  [0, 1, 0],
               ],
               8: [
                  [0, 1, 0],
                  [1, 0, 1],
                  [0, 1, 0],
                  [1, 0, 1],
                  [0, 1, 0],
               ],
               9: [
                  [0, 1, 0],
                  [1, 0, 1],
                  [0, 1, 1],
                  [0, 0, 1],
                  [1, 1, 0],
               ],
               "-": [
                  [0, 0, 0],
                  [0, 0, 0],
                  [1, 1, 1],
                  [0, 0, 0],
                  [0, 0, 0],
               ],
               "+": [
                  [0, 1, 0],
                  [0, 1, 0],
                  [1, 1, 1],
                  [0, 1, 0],
                  [0, 1, 0],
               ],
               "=": [
                  [0, 0, 0],
                  [1, 1, 1],
                  [0, 0, 0],
                  [1, 1, 1],
                  [0, 0, 0],
               ],
               "/": [
                  [0, 0, 1],
                  [0, 1, 0],
                  [0, 1, 0],
                  [1, 0, 0],
                  [1, 0, 0],
               ],
               ":": [
                  [0, 0, 0],
                  [0, 1, 0],
                  [0, 0, 0],
                  [0, 1, 0],
                  [0, 0, 0],
               ],
               ";": [
                  [0, 0, 0],
                  [0, 1, 0],
                  [0, 0, 0],
                  [0, 1, 0],
                  [1, 0, 0],
               ],
               "<": [
                  [0, 0, 1],
                  [0, 1, 0],
                  [1, 0, 0],
                  [0, 1, 0],
                  [0, 0, 1],
               ],
               ">": [
                  [1, 0, 0],
                  [0, 1, 0],
                  [0, 0, 1],
                  [0, 1, 0],
                  [1, 0, 0],
               ],
               "[": [
                  [1, 1, 0],
                  [1, 0, 0],
                  [1, 0, 0],
                  [1, 0, 0],
                  [1, 1, 0],
               ],
               "]": [
                  [0, 1, 1],
                  [0, 0, 1],
                  [0, 0, 1],
                  [0, 0, 1],
                  [0, 1, 1],
               ],
               "(": [
                  [0, 1, 0],
                  [1, 0, 0],
                  [1, 0, 0],
                  [1, 0, 0],
                  [0, 1, 0],
               ],
               ")": [
                  [0, 1, 0],
                  [0, 0, 1],
                  [0, 0, 1],
                  [0, 0, 1],
                  [0, 1, 0],
               ],
               "{": [
                  [0, 1, 1],
                  [1, 0, 0],
                  [1, 1, 0],
                  [1, 0, 0],
                  [0, 1, 1],
               ],
               "}": [
                  [1, 1, 0],
                  [0, 0, 1],
                  [0, 1, 1],
                  [0, 0, 1],
                  [1, 1, 0],
               ],
               "|": [
                  [0, 1, 0],
                  [0, 1, 0],
                  [0, 1, 0],
                  [0, 1, 0],
                  [0, 1, 0],
               ],
               "\\": [
                  [1, 0, 0],
                  [0, 1, 0],
                  [0, 1, 0],
                  [0, 0, 1],
                  [0, 0, 1],
               ],
               '"': [
                  [1, 0, 1],
                  [1, 0, 1],
                  [0, 0, 0],
                  [0, 0, 0],
                  [0, 0, 0],
               ],
               "#": [
                  [0, 1, 0],
                  [1, 1, 1],
                  [0, 1, 0],
                  [1, 1, 1],
                  [0, 1, 0],
               ],
               $: [
                  [0, 1, 1],
                  [1, 0, 0],
                  [0, 1, 0],
                  [0, 0, 1],
                  [1, 1, 0],
               ],
               "%": [
                  [1, 0, 1],
                  [0, 0, 1],
                  [0, 1, 0],
                  [1, 0, 0],
                  [1, 0, 1],
               ],
               "&": [
                  [0, 1, 0],
                  [1, 0, 1],
                  [0, 1, 0],
                  [1, 0, 1],
                  [0, 1, 1],
               ],
               "*": [
                  [1, 0, 1],
                  [0, 1, 0],
                  [1, 1, 1],
                  [0, 1, 0],
                  [1, 0, 1],
               ],
               "@": [
                  [0, 1, 1],
                  [1, 0, 1],
                  [1, 1, 1],
                  [1, 1, 0],
                  [0, 1, 1],
               ],
               "^": [
                  [0, 1, 0],
                  [1, 0, 1],
                  [0, 0, 0],
                  [0, 0, 0],
                  [0, 0, 0],
               ],
               _: [
                  [0, 0, 0],
                  [0, 0, 0],
                  [0, 0, 0],
                  [0, 0, 0],
                  [1, 1, 1],
               ],
               "~": [
                  [0, 0, 0],
                  [0, 1, 0],
                  [1, 0, 1],
                  [0, 0, 0],
                  [0, 0, 0],
               ],
               "`": [
                  [1, 0, 0],
                  [0, 1, 0],
                  [0, 0, 0],
                  [0, 0, 0],
                  [0, 0, 0],
               ],
               "'": [
                  [0, 1, 0],
                  [0, 1, 0],
                  [0, 0, 0],
                  [0, 0, 0],
                  [0, 0, 0],
               ],
            };

            function getRandomColor() {
               return colors[Math.floor(Math.random() * colors.length)];
            }

            function generatePattern(text) {
               currentText = text; // Update current text
               pixelContainer.innerHTML = "";
               pixels = [];
               textMap = [];

               const containerWidth = pixelContainer.clientWidth;
               const pixelSize =
                  window.innerWidth <= 480
                     ? 12
                     : window.innerWidth <= 768
                     ? 18
                     : 24;
               const gap =
                  window.innerWidth <= 480
                     ? 2
                     : window.innerWidth <= 768
                     ? 3
                     : 4;
               const columns = Math.floor(containerWidth / (pixelSize + gap));
               const rows = Math.max(15, 7);

               const charWidth = 3;
               const charHeight = 5;
               const spacing = 1;
               const totalWidth = text.length * (charWidth + spacing) - spacing;
               const startX = Math.floor((columns - totalWidth) / 2);
               const startY = Math.floor((rows - charHeight) / 2);

               for (let i = 0; i < rows; i++) {
                  textMap[i] = [];
                  for (let j = 0; j < columns; j++) {
                     textMap[i][j] = false;
                  }
               }

               text.split("").forEach((char, index) => {
                  const charMatrix = font[char] || font[" "];
                  const offsetX = startX + index * (charWidth + spacing);
                  for (let y = 0; y < charHeight; y++) {
                     for (let x = 0; x < charWidth; x++) {
                        if (charMatrix[y][x]) {
                           const gridX = offsetX + x;
                           const gridY = startY + y;
                           if (
                              gridX >= 0 &&
                              gridX < columns &&
                              gridY >= 0 &&
                              gridY < rows
                           ) {
                              textMap[gridY][gridX] = true;
                           }
                        }
                     }
                  }
               });
               for (let i = 0; i < rows; i++) {
                  for (let j = 0; j < columns; j++) {
                     const pixel = document.createElement("div");
                     pixel.className = "pixel";
                     pixel.dataset.row = i;
                     pixel.dataset.col = j;

                     let bgColor;
                     if (textMap[i][j]) {
                        bgColor = "#000000";
                        pixel.style.backgroundColor = bgColor;
                     } else {
                        bgColor = getRandomColor();
                        pixel.style.backgroundColor = bgColor;
                     }

                     // Set tooltip colors
                     pixel.style.setProperty(
                        "--color1",
                        getSimilarColor(bgColor)
                     );
                     pixel.style.setProperty(
                        "--color2",
                        getSimilarColor(bgColor)
                     );

                     pixelContainer.appendChild(pixel);
                     pixels.push(pixel);

                     pixel.addEventListener("click", function () {
                        if (!textMap[i][j]) {
                           const newColor = getRandomColor();
                           pixel.style.backgroundColor = newColor;
                           pixel.style.setProperty(
                              "--color1",
                              getSimilarColor(newColor)
                           );
                           pixel.style.setProperty(
                              "--color2",
                              getSimilarColor(newColor)
                           );
                        }
                     });
                  }
               }
               pixelContainer.classList.add("visible");
               waveAnimation.classList.add("visible");
            }

            const randomizationDirections = [
                [0, -1],    // Top
                [1, -1],    // Diagonal upper right
                [1, 0],     // Right
                [1, 1],     // Diagonal lower right
                [0, 1],     // Bottom
                [-1, 1],    // Diagonal lower left
                [-1, 0],    // Left
                [-1, -1]    // Diagonal upper left
            ];
            let currentDirectionIndex = 0;
            let waveAnimationInProgress = false; // Flag to prevent overlapping animations

            function startWaveAnimation(directionIndex) {
                if (waveAnimationInProgress) return;
                waveAnimationInProgress = true;

                const direction = randomizationDirections[directionIndex];
                let startRow, startCol, rowIncrement, colIncrement, rowLimit, colLimit;
                let isRowWave = false; // Flag to determine if it's a row-wise or column-wise wave

                if (direction[1] === -1) { // Top directions (row-wise)
                    startRow = 0; rowLimit = pixelContainer.children.length / getColumns(); rowIncrement = 1;
                    isRowWave = true;
                } else if (direction[1] === 1) { // Bottom directions (row-wise)
                    startRow = pixelContainer.children.length / getColumns() - 1; rowLimit = -1; rowIncrement = -1;
                    isRowWave = true;
                } else if (direction[0] === 1) { // Right direction (column-wise)
                    startCol = getColumns() - 1; colLimit = -1; colIncrement = -1;
                    startRow = 0; rowLimit = pixelContainer.children.length / getColumns(); rowIncrement = 1; // Iterate through rows
                    isRowWave = false;
                } else if (direction[0] === -1) { // Left direction (column-wise)
                    startCol = 0; colLimit = getColumns(); colIncrement = 1;
                    startRow = 0; rowLimit = pixelContainer.children.length / getColumns(); rowIncrement = 1; // Iterate through rows
                    isRowWave = false;
                } else { // Vertical directions (column-wise, e.g., [0, 0] - not used in directions, but for completeness)
                    startCol = 0; colLimit = getColumns(); colIncrement = 1;
                    startRow = 0; rowLimit = pixelContainer.children.length / getColumns(); rowIncrement = 1; // Iterate through rows
                    isRowWave = false;
                }


                let delay = 0;

                if (isRowWave) { // Row-wise wave
                    for (let i = startRow; rowIncrement > 0 ? i < rowLimit : i > rowLimit; i += rowIncrement) {
                        setTimeout(() => {
                            for (let j = 0; j < getColumns(); j++) { // Iterate through columns in each row
                                const pixelIndex = i * getColumns() + j;
                                if (pixelIndex >= 0 && pixelIndex < pixelContainer.children.length) {
                                    const pixel = pixelContainer.children[pixelIndex];
                                    const row = parseInt(pixel.dataset.row);
                                    const col = parseInt(pixel.dataset.col);
                                    if (!textMap[row][col]) {
                                        const newColor = getRandomColor();
                                        pixel.style.backgroundColor = newColor;
                                        pixel.style.setProperty(
                                            "--color1",
                                            getSimilarColor(newColor)
                                        );
                                        pixel.style.setProperty(
                                            "--color2",
                                            getSimilarColor(newColor)
                                        );
                                    }
                                    pixel.style.animation = 'pulse-animation 1ms ease-in-out';
                                    pixel.addEventListener('animationend', function() {
                                        pixel.style.animation = 'none';
                                    }, { once: true });
                                }
                            }
                            if (i === (direction[1] === -1 ? rowLimit -1 : -1 + 1)) { // Check for last row in wave
                                setTimeout(() => {
                                    waveAnimationInProgress = false;
                                }, 10);
                            }
                        }, delay);
                        delay += 100; // Delay between rows
                    }
                } else { // Column-wise wave
                    for (let j = startCol; colIncrement > 0 ? j < colLimit : j > colIncrement; j += colIncrement) {
                         setTimeout(() => {
                            for (let i = 0; i < pixelContainer.children.length / getColumns(); i++) { // Iterate through rows in each column
                                const pixelIndex = i * getColumns() + j;
                                if (pixelIndex >= 0 && pixelIndex < pixelContainer.children.length) {
                                    const pixel = pixelContainer.children[pixelIndex];
                                    const row = parseInt(pixel.dataset.row);
                                    const col = parseInt(pixel.dataset.col);
                                    if (!textMap[row][col]) {
                                        const newColor = getRandomColor();
                                        pixel.style.backgroundColor = newColor;
                                        pixel.style.setProperty(
                                            "--color1",
                                            getSimilarColor(newColor)
                                        );
                                        pixel.style.setProperty(
                                            "--color2",
                                            getSimilarColor(newColor)
                                        );
                                    }
                                    pixel.style.animation = 'pulse-animation 1ms ease-in-out';
                                    pixel.addEventListener('animationend', function() {
                                        pixel.style.animation = 'none';
                                    }, { once: true });
                                }
                            }
                            if (j === (direction[0] === 1 ? -1 + 1 : colLimit - 1)) { // Check for last column in wave
                                setTimeout(() => {
                                    waveAnimationInProgress = false;
                                }, 100);
                            }
                        }, delay);
                        delay += 20; // Delay between columns
                    }
                }


                currentDirectionIndex = (currentDirectionIndex + 1) % randomizationDirections.length;
            }

            function randomizeColorsFromDirections() {
                startWaveAnimation(currentDirectionIndex);
            }

            function startHeartbeatAnimation() {
                const heartbeatPixelsCount = Math.floor(pixels.length * 0.1); // 10% of pixels pulsating
                const randomIndices = [];
                while (randomIndices.length < heartbeatPixelsCount) {
                    const randomIndex = Math.floor(Math.random() * pixels.length);
                    if (!randomIndices.includes(randomIndex)) {
                        randomIndices.push(randomIndex);
                    }
                }

                randomIndices.forEach(index => {
                    const pixel = pixels[index];
                    pixel.style.animation = 'heartbeat-pulse 1.5s ease-in-out infinite alternate'; // Apply heartbeat pulse
                });
            }


            function getColumns() {
                const containerWidth = pixelContainer.clientWidth;
                const pixelSize =
                  window.innerWidth <= 480
                     ? 12
                     : window.innerWidth <= 768
                     ? 18
                     : 24;
                const gap =
                  window.innerWidth <= 480
                     ? 2
                     : window.innerWidth <= 768
                     ? 3
                     : 4;
                return Math.floor(containerWidth / (pixelSize + gap));
            }


            function toggleAnimation() {
               animationEnabled = !animationEnabled;
               // No toggle animation needed now, keeping function if needed later
            }

            // Initial pattern generation with default text
            function initialSetup() {
                const defaultText = "HI, I'M Jigx!"; // Or any default text
                generatePattern(defaultText);
                startHeartbeatAnimation(); // Start heartbeat animation immediately on load
            }


            submitNameBtn.addEventListener("click", function() {
                const userName = userNameInput.value.trim();
                if (userName) {
                    userNameInputContainer.style.display = 'none';
                    inputContainer.classList.add('visible');
                    controls.classList.add('visible');
                    userDisplayName.textContent = userName;
                    generatePattern("HI " + userName.toUpperCase() + "!"); // Append HI and !
                } else {
                    alert("Please enter your name.");
                }
            });


            randomizeBtn.addEventListener("click", randomizeColorsFromDirections);
            toggleAnimationBtn.addEventListener("click", toggleAnimation);


            // Set interval for automatic color randomization
            setInterval(randomizeColorsFromDirections, 30000); // 30 seconds
            setInterval(startHeartbeatAnimation, 2500); // Heartbeat every 2.5 seconds


            window.addEventListener("resize", function () {
               if (currentText) generatePattern(currentText); // Regenerate pattern on resize
            });

            // Initial setup: show name input only
            inputContainer.classList.remove('visible'); // Hide initially
            controls.classList.remove('visible'); // Hide initially
            pixelContainer.classList.add('visible'); // Show pixel container to show initial pattern
            waveAnimation.classList.add('visible'); // Show wave animation initially
            initialSetup(); // Generate initial pattern
         });
      </script>
   </body>
</html>